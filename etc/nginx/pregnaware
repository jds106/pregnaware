# These are the default settings for the website
# Save in /etc/nginx/sites-enabled
#server {
#
#    listen 80 default_server;
#    listen [::]:80 default_server ipv6only=on;
#
#    server_name "";
#
#    # Redirect the root website to the login page
#    location / {
#         index /html/login.html;
#    }
#
#    # Handle resource requests (this implicitly sets the root for the site)
#    location ~ /(css|html|js)  {
#        root /home/ubuntu/dist/latest/www;
#    }
#
#    # Convenience redirects
#    location /login     { rewrite ^.* /html/login.html; }
#    location /main      { rewrite ^.* /html/main.html; }
#    location /share     { rewrite ^.* /html/share.html; }
#    location /account   { rewrite ^.* /html/account.html; }
#    location /newfriend { rewrite ^.* /html/newfriend.html; }
#
#    # Forward all REST requests to the Front End Service
#    location /FrontEndSvc {
#        proxy_pass http://localhost:8601;
#    }
#}

# Instructions for setting the HTTPS connections up are here:
#       https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-14-04

server {
    listen 80;
    server_name pregnaware.co.uk www.pregnaware.co.uk;
    return 301 https://$host$request_uri;
}

server {
    listen 443 default_server;
    listen [::]:443 default_server ipv6only=on;

    server_name pregnaware.co.uk www.pregnaware.co.uk;

    ssl on;

    ssl_certificate /etc/letsencrypt/live/pregnaware.co.uk/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/pregnaware.co.uk/privkey.pem;

    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';

    # Redirect the root website to the login page
    location / {
         index /html/login.html;
    }

    # Handle resource requests (this implicitly sets the root for the site)
    location ~ /(css|html|js)  {
        root /home/ubuntu/dist/latest/www;
    }

    # Convenience redirects
    location /login     { rewrite ^.* /html/login.html; }
    location /main      { rewrite ^.* /html/main.html; }
    location /share     { rewrite ^.* /html/share.html; }
    location /account   { rewrite ^.* /html/account.html; }
    location /newfriend { rewrite ^.* /html/newfriend.html; }

    # Forward all REST requests to the Front End Service
    location /FrontEndSvc {
        proxy_pass http://localhost:8601;
    }
}